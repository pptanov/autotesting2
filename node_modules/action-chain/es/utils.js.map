{"version":3,"file":"utils.js","sourceRoot":"","sources":["../src/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import { EffectResult } from './types'\n\nexport const doNotProxy = Symbol('doNotProxy')\n\nfunction isObject(value) {\n  return typeof value === 'object' && !Array.isArray(value) && value !== null\n}\n\nlet hasWarnedConstructor = false\n\nfunction createProxyGetHandler(\n  path: string,\n  cb: (effect: EffectResult) => void\n): ProxyHandler<any>['get'] {\n  return (target, prop) => {\n    if (typeof target[prop] === 'function') {\n      const func = function(...args) {\n        const result = target[prop].apply(this, args)\n        if (result instanceof Promise) {\n          result.then((promisedResult) => {\n            // eslint-disable-next-line standard/no-callback-literal\n            cb({\n              name: path,\n              method: prop,\n              args,\n              result: promisedResult,\n            })\n          })\n        } else {\n          // eslint-disable-next-line standard/no-callback-literal\n          cb({\n            name: path,\n            method: prop,\n            args,\n            result,\n          })\n        }\n        return result\n      }\n\n      return new Proxy(func, {\n        construct(_, args) {\n          // eslint-disable-next-line\n          cb({\n            name: path,\n            method: prop,\n            args,\n            result: `[${prop.toString()}]`,\n          })\n\n          if (!hasWarnedConstructor) {\n            console.warn(\n              `EFFECTS - It is highly recommended to create a custom effect, exposing a method that deals with the instantiation of \"${path}.${prop.toString()}\". It improves readability and debugability of your app`\n            )\n            hasWarnedConstructor = true\n          }\n\n          return new target[prop](...args)\n        },\n      })\n    }\n    if (isObject(target[prop])) {\n      return new Proxy(target[prop], {\n        get: createProxyGetHandler(path + '.' + prop.toString(), cb),\n      })\n    }\n    return target[prop]\n  }\n}\n\nexport function proxifyEffects<Effects>(\n  effects: Effects,\n  skipKeys: string[] = [],\n  cb: (effect: EffectResult) => void\n): Effects {\n  return Object.keys(effects).reduce(\n    (currentEffects, key) => {\n      const effect = effects[key]\n      if (skipKeys.indexOf(key) === -1 && isObject(effect)) {\n        currentEffects[key] = new Proxy(effect, {\n          get: createProxyGetHandler(key, cb),\n        })\n      } else {\n        currentEffects[key] = effect\n      }\n      return currentEffects\n    },\n    {} as Effects\n  )\n}\n"]}